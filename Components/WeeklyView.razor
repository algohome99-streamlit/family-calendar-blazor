@inject IDataService DataService

<div class="weekly-section">
    <h2>ğŸ“† æœ¬é€±è¡Œç¨‹è¡¨</h2>

    <div class="week-grid">
        @foreach (var day in weekDays)
        {
            var isToday = day.Date == DateTime.Today;
            var dayEvents = events.Where(e => e.Date.Date == day.Date).ToList();

            <div class="week-day">
                <div class="week-day-header @(isToday ? "today" : "")">
                    <div>é€±@GetDayName(day.DayOfWeek)</div>
                    <div>@day.ToString("MM/dd")</div>
                </div>

                @if (dayEvents.Any())
                {
                    @foreach (var evt in dayEvents)
                    {
                        <div class="week-event" style="background-color: @GetMemberColor(evt.Member)">
                            @evt.GetIcon() @evt.Content
                            @if (evt.IsRecurring)
                            {
                                <span>ğŸ”</span>
                            }
                        </div>
                    }
                }
                else
                {
                    <div class="week-event" style="color: #ccc; text-align: center;">---</div>
                }
            </div>
        }
    </div>
</div>

@code {
    [Parameter] public List<Event> Events { get; set; } = new();

    private List<Event> events = new();
    private List<DateTime> weekDays = new();

    protected override void OnParametersSet()
    {
        events = Events;
        CalculateWeekDays();
    }

    private void CalculateWeekDays()
    {
        var today = DateTime.Today;
        var monday = today.AddDays(-(int)today.DayOfWeek + (int)DayOfWeek.Monday);
        if (today.DayOfWeek == DayOfWeek.Sunday)
        {
            monday = monday.AddDays(-7);
        }

        weekDays = Enumerable.Range(0, 7).Select(i => monday.AddDays(i)).ToList();
    }

    private string GetDayName(DayOfWeek day) => day switch
    {
        DayOfWeek.Monday => "ä¸€",
        DayOfWeek.Tuesday => "äºŒ",
        DayOfWeek.Wednesday => "ä¸‰",
        DayOfWeek.Thursday => "å››",
        DayOfWeek.Friday => "äº”",
        DayOfWeek.Saturday => "å…­",
        DayOfWeek.Sunday => "æ—¥",
        _ => ""
    };

    private string GetMemberColor(string member) => member switch
    {
        "å“¥å“¥" => "#e3f2fd",
        "å¦¹å¦¹" => "#fce4ec",
        "å…¨å®¶" => "#fff9c4",
        _ => "#f0f0f0"
    };
}
